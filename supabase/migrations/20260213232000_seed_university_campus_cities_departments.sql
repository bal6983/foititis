-- ============================================================
-- UNIVERSITY CAMPUS CITY COVERAGE (SCHOOLS -> DEPARTMENTS -> CITIES)
--
-- Seeds representative campus-city coverage per university so
-- city filtering can reflect multi-city universities (e.g. IHU).
-- ============================================================

-- 1) Ensure extra campus cities exist
create unique index if not exists idx_cities_name_unique
  on public.cities(name);

insert into public.cities (name)
values
  ('Αλεξανδρούπολη'),
  ('Ορεστιάδα'),
  ('Ξάνθη'),
  ('Διδυμότειχο'),
  ('Καβάλα'),
  ('Δράμα'),
  ('Ρέθυμνο'),
  ('Χίος'),
  ('Σάμος'),
  ('Ρόδος'),
  ('Σύρος'),
  ('Λήμνος'),
  ('Λάρισα'),
  ('Τρίκαλα'),
  ('Καρδίτσα'),
  ('Λαμία'),
  ('Καλαμάτα'),
  ('Σπάρτη'),
  ('Ναύπλιο'),
  ('Κόρινθος'),
  ('Φλώρινα'),
  ('Καστοριά'),
  ('Γρεβενά'),
  ('Πτολεμαΐδα'),
  ('Άγιος Νικόλαος'),
  ('Σητεία'),
  ('Ιεράπετρα'),
  ('Σέρρες'),
  ('Κατερίνη'),
  ('Κιλκίς'),
  ('Αργοστόλι'),
  ('Ληξούρι'),
  ('Λευκάδα'),
  ('Ζάκυνθος'),
  ('Άρτα')
on conflict (name) do nothing;

-- 2) Create one canonical school per university (idempotent)
insert into public.schools (name, university_id)
select 'Κεντρική Σχολή', u.id
from public.universities u
where not exists (
  select 1
  from public.schools s
  where s.university_id = u.id
    and s.name = 'Κεντρική Σχολή'
);

-- 3) Seed campus-city coverage at department level
with campus_map (university_name, city_name) as (
  values
    ('Εθνικό και Καποδιστριακό Πανεπιστήμιο Αθηνών', 'Αθήνα'),
    ('Εθνικό Μετσόβιο Πολυτεχνείο', 'Αθήνα'),
    ('Αριστοτέλειο Πανεπιστήμιο Θεσσαλονίκης', 'Θεσσαλονίκη'),
    ('Πανεπιστήμιο Πατρών', 'Πάτρα'),
    ('Πανεπιστήμιο Ιωαννίνων', 'Ιωάννινα'),
    ('Πανεπιστήμιο Ιωαννίνων', 'Άρτα'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Κομοτηνή'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Ξάνθη'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Αλεξανδρούπολη'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Ορεστιάδα'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Διδυμότειχο'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Καβάλα'),
    ('Δημοκρίτειο Πανεπιστήμιο Θράκης', 'Δράμα'),
    ('Πανεπιστήμιο Κρήτης', 'Ηράκλειο'),
    ('Πανεπιστήμιο Κρήτης', 'Ρέθυμνο'),
    ('Πολυτεχνείο Κρήτης', 'Χανιά'),
    ('Πανεπιστήμιο Αιγαίου', 'Μυτιλήνη'),
    ('Πανεπιστήμιο Αιγαίου', 'Χίος'),
    ('Πανεπιστήμιο Αιγαίου', 'Σάμος'),
    ('Πανεπιστήμιο Αιγαίου', 'Ρόδος'),
    ('Πανεπιστήμιο Αιγαίου', 'Σύρος'),
    ('Πανεπιστήμιο Αιγαίου', 'Λήμνος'),
    ('Πανεπιστήμιο Θεσσαλίας', 'Βόλος'),
    ('Πανεπιστήμιο Θεσσαλίας', 'Λάρισα'),
    ('Πανεπιστήμιο Θεσσαλίας', 'Τρίκαλα'),
    ('Πανεπιστήμιο Θεσσαλίας', 'Καρδίτσα'),
    ('Πανεπιστήμιο Θεσσαλίας', 'Λαμία'),
    ('Πανεπιστήμιο Μακεδονίας', 'Θεσσαλονίκη'),
    ('Πανεπιστήμιο Πειραιώς', 'Πειραιάς'),
    ('Οικονομικό Πανεπιστήμιο Αθηνών', 'Αθήνα'),
    ('Πάντειο Πανεπιστήμιο', 'Αθήνα'),
    ('Γεωπονικό Πανεπιστήμιο Αθηνών', 'Αθήνα'),
    ('Χαροκόπειο Πανεπιστήμιο', 'Αθήνα'),
    ('Ιόνιο Πανεπιστήμιο', 'Κέρκυρα'),
    ('Ιόνιο Πανεπιστήμιο', 'Λευκάδα'),
    ('Ιόνιο Πανεπιστήμιο', 'Αργοστόλι'),
    ('Ιόνιο Πανεπιστήμιο', 'Ληξούρι'),
    ('Ιόνιο Πανεπιστήμιο', 'Ζάκυνθος'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Τρίπολη'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Καλαμάτα'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Σπάρτη'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Ναύπλιο'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Κόρινθος'),
    ('Πανεπιστήμιο Πελοποννήσου', 'Πάτρα'),
    ('Πανεπιστήμιο Δυτικής Μακεδονίας', 'Κοζάνη'),
    ('Πανεπιστήμιο Δυτικής Μακεδονίας', 'Φλώρινα'),
    ('Πανεπιστήμιο Δυτικής Μακεδονίας', 'Καστοριά'),
    ('Πανεπιστήμιο Δυτικής Μακεδονίας', 'Γρεβενά'),
    ('Πανεπιστήμιο Δυτικής Μακεδονίας', 'Πτολεμαΐδα'),
    ('Ελληνικό Μεσογειακό Πανεπιστήμιο', 'Ηράκλειο'),
    ('Ελληνικό Μεσογειακό Πανεπιστήμιο', 'Άγιος Νικόλαος'),
    ('Ελληνικό Μεσογειακό Πανεπιστήμιο', 'Σητεία'),
    ('Ελληνικό Μεσογειακό Πανεπιστήμιο', 'Ιεράπετρα'),
    ('Πανεπιστήμιο Δυτικής Αττικής', 'Αθήνα'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Θεσσαλονίκη'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Σέρρες'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Καβάλα'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Δράμα'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Κατερίνη'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Κιλκίς'),
    ('Διεθνές Πανεπιστήμιο της Ελλάδος', 'Διδυμότειχο'),
    ('Ελληνικό Ανοικτό Πανεπιστήμιο', 'Πάτρα'),
    ('Ανωτάτη Σχολή Καλών Τεχνών', 'Αθήνα')
),
resolved as (
  select
    s.id as school_id,
    c.id as city_id,
    m.city_name
  from campus_map m
  join public.universities u on u.name = m.university_name
  join public.schools s on s.university_id = u.id and s.name = 'Κεντρική Σχολή'
  join public.cities c on c.name = m.city_name
)
insert into public.departments (name, school_id, city_id)
select
  'Τμήμα ' || city_name,
  school_id,
  city_id
from resolved
on conflict (school_id, name, city_id) do nothing;
